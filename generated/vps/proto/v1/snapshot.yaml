# Generated with protoc-gen-openapi
# https://github.com/google/gnostic/tree/master/apps/protoc-gen-openapi

openapi: 3.0.3
info:
    title: SnapshotService
    version: 0.0.1
paths:
    /v1/vps/snapshot:
        get:
            summary: get all snapshots
            operationId: SnapshotService_GetAll
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/GetAllResponse'
        post:
            summary: create a snapshot
            operationId: SnapshotService_Create
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CreateRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CreateResponse'
    /v1/vps/snapshot/calculator:
        post:
            summary: create cost calculator for snapshot creating
            operationId: SnapshotService_CreateCalculator
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CreateCalculatorRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CreateCalculatorResponse'
    /v1/vps/snapshot/restore:
        get:
            summary: get restore list
            operationId: SnapshotService_GetAllRestores
            parameters:
                - name: id
                  in: query
                  description: snapshot id. Optional, full list at 0
                  schema:
                    type: string
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/GetAllRestoresResponse'
    /v1/vps/snapshot/{id}:
        put:
            summary: edit snapshot user fields
            operationId: SnapshotService_Edit
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/EditRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/EditResponse'
        delete:
            summary: remove the snapshot
            operationId: SnapshotService_Remove
            parameters:
                - name: id
                  in: query
                  description: snapshot id
                  schema:
                    type: string
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/RemoveResponse'
    /v1/vps/snapshot/{id}/restore:
        post:
            summary: create a restore for the snapshot
            operationId: SnapshotService_Restore
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/RestoreRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/RestoreResponse'
components:
    schemas:
        CreateCalculatorRequest:
            properties:
                vps_id:
                    type: string
                    description: vps id (uuid)
        CreateCalculatorResponse:
            properties:
                price_day:
                    type: number
                    description: cost per day in rub
                    format: double
                price_day_gb:
                    type: number
                    description: cost per day for gb in rub
                    format: double
                size:
                    type: integer
                    description: size in gb
                    format: uint32
        CreateRequest:
            properties:
                vps_id:
                    type: string
                    description: vps id (uuid)
                description:
                    type: string
                    description: user title for snapshot
                consistent:
                    type: boolean
                    description: stop vps before snapshot?
        CreateResponse:
            properties:
                snapshot:
                    $ref: '#/components/schemas/Snapshot'
                error:
                    $ref: '#/components/schemas/Error'
        EditRequest:
            properties:
                id:
                    type: integer
                    description: snapshot id
                    format: uint64
                description:
                    type: string
                    description: user title for snapshot
        EditResponse:
            properties:
                snapshot:
                    $ref: '#/components/schemas/Snapshot'
        GetAllResponse:
            properties:
                snapshot:
                    type: array
                    items:
                        $ref: '#/components/schemas/Snapshot'
        GetAllRestoresResponse:
            properties:
                restore:
                    type: array
                    items:
                        $ref: '#/components/schemas/Restore'
        OperatingSystem:
            properties:
                id:
                    type: integer
                    description: Идентификатор ОС
                    format: uint32
                distro_name:
                    type: string
                    description: Системное имя дистрибутива (например, для группировки)
                distro_display_name:
                    type: string
                    description: Отображаемое имя дистрибутива
                version:
                    type: string
                    description: Версия дистрибутива (отображаемое значение)
                active:
                    type: boolean
                    description: Доступна ли ОС для выбора пользователю (визуально)
                requirements:
                    $ref: '#/components/schemas/Requirements'
            description: Описывает ОС для установки на Vps (пара дистрибутив + версия)
        RemoveResponse:
            properties:
                snapshot:
                    $ref: '#/components/schemas/Snapshot'
                error:
                    $ref: '#/components/schemas/Error'
        RequiredConfiguration:
            properties:
                cpu_count:
                    type: integer
                    description: CPU cores
                    format: uint32
                disk_size:
                    type: integer
                    description: disk size, Mb
                    format: uint32
                memory:
                    type: integer
                    description: RAM, Mb
                    format: uint32
        Restore:
            properties:
                id:
                    type: integer
                    description: restore order id
                    format: uint64
                snapshot:
                    $ref: '#/components/schemas/Snapshot'
                vps_id:
                    type: string
                    description: target vps id
                vps_name:
                    type: string
                    description: target vps name
                target_type:
                    type: integer
                    description: 'restore type: existing or new vps'
                    format: enum
                date_create:
                    type: string
                    description: start restore datetime (RFC3339)
                date_complete:
                    type: string
                    description: finish restore datetime (RFC3339)
                status:
                    type: integer
                    description: current restore status
                    format: enum
        RestoreRequest:
            properties:
                id:
                    type: integer
                    description: snapshot id
                    format: uint64
                vps_id:
                    type: string
                    description: target vps to restore
        RestoreResponse:
            properties:
                restore:
                    $ref: '#/components/schemas/Restore'
                error:
                    $ref: '#/components/schemas/Error'
        Snapshot:
            properties:
                id:
                    type: integer
                    description: snapshot id
                    format: uint64
                vps_id:
                    type: string
                    description: vps id (uuid)
                vps_name:
                    type: string
                    description: vps name
                date_create:
                    type: string
                    description: snapshot create date W3C
                size:
                    type: integer
                    description: bytes
                    format: uint64
                status:
                    type: integer
                    description: current snapshot status
                    format: enum
                operating_system:
                    $ref: '#/components/schemas/OperatingSystem'
                description:
                    type: string
                    description: user title for snapshot
                configuration:
                    $ref: '#/components/schemas/RequiredConfiguration'
                price_day:
                    type: number
                    description: cost per day in rub
                    format: double
