# Generated with protoc-gen-openapi
# https://github.com/google/gnostic/tree/master/apps/protoc-gen-openapi

openapi: 3.0.3
info:
    title: BackupService
    version: 0.0.1
paths:
    /v1/vps/backup:
        get:
            operationId: BackupService_GetAvailableCopies
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/GetAvailableCopiesResponse'
    /v1/vps/backup/orders:
        get:
            operationId: BackupService_GetOrders
            parameters:
                - name: limit
                  in: query
                  description: Количество записей на страницу (от 1 до 100)
                  schema:
                    type: string
                - name: offset
                  in: query
                  description: Смещение относительно нулевой (последней) записи
                  schema:
                    type: string
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/GetOrdersResponse'
    /v1/vps/{id}/backup/{copy_id}:
        get:
            operationId: BackupService_GetBackupFileList
            parameters:
                - name: id
                  in: query
                  description: Идентификатор VPS (uuid)
                  schema:
                    type: string
                - name: copy_id
                  in: query
                  description: Идентификатор копии
                  schema:
                    type: string
                - name: path
                  in: query
                  description: Путь для отображения
                  schema:
                    type: string
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/GetBackupFileListResponse'
    /v1/vps/{id}/backup/{copy_id}/file:
        post:
            operationId: BackupService_RestoreFile
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/RestoreFileRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/RestoreFileResponse'
    /v1/vps/{id}/backup/{copy_id}/server:
        post:
            operationId: BackupService_RestoreServer
            requestBody:
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/RestoreServerRequest'
                required: true
            responses:
                "200":
                    description: OK
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/RestoreServerResponse'
components:
    schemas:
        CopyInfo:
            properties:
                id:
                    type: integer
                    description: Идентификатор копии
                    format: uint64
                vps_id:
                    type: string
                    description: Идентификатор VPS (uuid)
                vps_name:
                    type: string
                    description: Имя VPS, с которого создавалась резервная копия
                date:
                    type: string
                    description: Дата создания копии в RFC3339
                operating_system:
                    $ref: '#/components/schemas/OperatingSystem'
                size:
                    type: integer
                    description: Общий размер резервной копии в байтах
                    format: uint64
                configuration:
                    $ref: '#/components/schemas/Configuration'
        FileInfo:
            properties:
                is_link:
                    type: boolean
                    description: Является ли файл символической ссылкой
                is_dir:
                    type: boolean
                    description: Является ли файл директорией
                name:
                    type: string
                    description: Название файла
                    format: bytes
                ext:
                    type: string
                    description: Расширение файла, если оно есть
                    format: bytes
                path:
                    type: string
                    description: Путь к файлу
                    format: bytes
                owner:
                    type: string
                    description: Владелец файла
                group:
                    type: string
                    description: Группа владельца
                size:
                    type: integer
                    description: Размер файла в байтах
                    format: uint64
                mtime:
                    type: number
                    description: Время изменения (unix timestamp)
                    format: double
                mtime_str:
                    type: string
                    description: Время изменения в читаемом виде
                mode:
                    type: string
                    description: Права на файл, например, "777"
        GetAvailableCopiesResponse:
            properties:
                copy:
                    type: array
                    items:
                        $ref: '#/components/schemas/CopyInfo'
                    description: Список копий
        GetBackupFileListResponse:
            properties:
                file:
                    type: array
                    items:
                        $ref: '#/components/schemas/FileInfo'
                    description: Список файлов
        GetOrdersResponse:
            properties:
                order:
                    type: array
                    items:
                        $ref: '#/components/schemas/OrderInfo'
        OperatingSystem:
            properties:
                id:
                    type: integer
                    description: Идентификатор ОС
                    format: uint32
                distro_name:
                    type: string
                    description: Системное имя дистрибутива (например, для группировки)
                distro_display_name:
                    type: string
                    description: Отображаемое имя дистрибутива
                version:
                    type: string
                    description: Версия дистрибутива (отображаемое значение)
                active:
                    type: boolean
                    description: Доступна ли ОС для выбора пользователю (визуально)
                requirements:
                    $ref: '#/components/schemas/Requirements'
            description: Описывает ОС для установки на Vps (пара дистрибутив + версия)
        OrderInfo:
            properties:
                id:
                    type: integer
                    description: Идентификатор задания
                    format: uint64
                vps_id:
                    type: string
                    description: Идентификатор VPS (uuid)
                vps_name:
                    type: string
                    description: Имя сервера, на который выполнялось восстановление
                type:
                    type: integer
                    description: Тип задания
                    format: enum
                date_create:
                    type: string
                    description: Дата создания задания (RFC3339)
                date_complete:
                    type: string
                    description: Дата завершения задания (RFC3339)
                path:
                    type: array
                    items:
                        type: string
                    description: Список путей для восстановления/скачивания
                status:
                    type: integer
                    description: Статус завершения
                    format: enum
                copy_info:
                    $ref: '#/components/schemas/CopyInfo'
                affect_live:
                    type: boolean
                    description: Операция производится без выключения VPS
                target:
                    type: string
                    description: Директория, в которую производилось восстановление (актуально для выборочного восстановления файлов)
                error_details:
                    $ref: '#/components/schemas/ErrorDetails'
        RestoreFileRequest:
            properties:
                id:
                    type: string
                    description: Идентификатор VPS (uuid)
                copy_id:
                    type: integer
                    description: Идентификатор копии
                    format: uint64
                path:
                    type: array
                    items:
                        type: string
                    description: Список путей для восстановления
                affect_live:
                    type: boolean
                    description: Восстановление без выключения VPS
                target:
                    type: string
                    description: Директория, в которую будет происходить восстановление. По-умолчанию - "/"
        RestoreFileResponse:
            properties:
                order:
                    $ref: '#/components/schemas/OrderInfo'
                error:
                    $ref: '#/components/schemas/Error'
        RestoreServerRequest:
            properties:
                id:
                    type: string
                    description: Идентификатор VPS, в который происходит восстановление (uuid)
                copy_id:
                    type: integer
                    description: Идентификатор копии
                    format: uint64
        RestoreServerResponse:
            properties:
                order:
                    $ref: '#/components/schemas/OrderInfo'
                error:
                    $ref: '#/components/schemas/Error'
